#The next line was generated by 'mkmake'
HOST=i386_nbsd1

#-----------------------------------------------------------------------------
#			Makefile for ghist960
#
# $Id: Makefile,v 1.37 1995/10/09 20:56:35 greg Exp $
#-----------------------------------------------------------------------------

# Essential under System V, harmless elsewhere
SHELL = /bin/sh

TARG	= ghist960
IDIR	= ../../include
BFDIDIR	= ../../libbfd/common
LDIR	= $(G960BASE)/lib
BFDLDIR = $(LDIR)
CFLAGS	= $(OPT) -I$(IDIR) -I$(BFDIDIR) $(HOSTDEFS)

#-----------  DEFAULTS  ---------------------------
O	= o
RM	= rm -f
CP	= cp
LN	= ln
LB	= a
STRIP	= strip
OPT	= -g
IOPT	= -O
OUT	= -o
DEST	= $(G960BASE)/bin

#-----------------------------------------------------------------------------
#		Uncomment for i386 / System V
#__i386v__#HOSTDEFS = -DUSG
#__i386v__#HOSTLIBS = -lPW
#-----------------------------------------------------------------------------
#		Uncomment for i386 / System V release 4
#__i386vr4__#HOSTDEFS = -DUSG
#-----------------------------------------------------------------------------
#		Uncomment for NCR System V
#__68020v__#HOSTDEFS = -DUSG
#__68020v__#HOSTLIBS = -lPW
#-----------------------------------------------------------------------------
#		Uncomment for RS/6000
#__rs6000__#HOSTDEFS = -DUSG -DPOSIX -qchars=signed
#__rs6000__#LDFLAGS = -b nodelcsect
#-----------------------------------------------------------------------------
#		Uncomment for HP-UX
#__hp9000__#HOSTDEFS = -DUSG
#-----------------------------------------------------------------------------
#		Uncomment for Apollo 400
#__ap400__#HOSTDEFS = -A nansi
#-----------------------------------------------------------------------------
#		Uncomment for Sun 3
#__sun3__#LDFLAGS = -Bstatic
#-----------------------------------------------------------------------------
#		Uncomment for Sun 386i
#__sun386i__#LDFLAGS = -Bstatic
#-----------------------------------------------------------------------------
#		Uncomment for Sun 4
#__sun4__#LDFLAGS = -Bstatic
#-----------------------------------------------------------------------------
#		Uncomment for Solaris on the sun4 (sol-sun4).
#__sol-sun4__#HOSTDEFS  = -DUSG
#__sol-sun4__#LDFLAGS = -Bstatic
#-----------------------------------------------------------------------------
#		Uncomment for DOS
#__dos__#O		= obj
#__dos__#EXE		= .exe
#__dos__#EXP		= .exp
#__dos__#LB		= lib
#__dos__#RM		= del
#__dos__#CC		= hc386
#__dos__#CP		= copy
#__dos__#LN		= copy
#__dos__#STRIP		= echo # No-op
#__dos__#HOSTDEFS	= -DDOS -DUSG -w1 -fsoft -stack 80000H -twocase
#__dos__#OPT		= -g 
#__dos__#IOPT		= -O3
#__dos__#LDFLAGS	= $(OPT) -fsoft "-maxreal 0ffffh" -stack 80000H -nomap -twocase -nostub
#__dos__#OUT		= -e
#__dos__#DEST		= $(G960BASE,/=\)\bin
#__dos__#DOSXP		= c:\tnt
#__dos__#DOSXN		= $(DOSXP)\bin\gotnt.exe
#__dos__#CFIG           = $(DOSXP)\bin\cfig386
#__dos__#CFIGFLAGS      = -saveregs -maxvcpimem 0 -vmfile vmmdrv.exp
#-----------------------------------------------------------------------------
#		Uncomment for Windows 95
#__win95__#O		= obj
#__win95__#EXE		= .exe
#__win95__#LB		= lib
#__win95__#CC		= CL
#__win95__#LN		= copy
#__win95__#STRIP		= echo # No-op
#__win95__#HOSTDEFS	= -W2 -DWIN95 -DDOS -DUSG
#__win95__#OPT		= -Zi
#__win95__#IOPT		= -O2
#__win95__#OUT		= -o
#__win95__#DEST		= $(G960BASE,/=\)\bin
#-----------------------------------------------------------------------------

OBJS	= ghist960.$O ver960.$O
LIBS	= $(LDIR)/toolib.$(LB) $(BFDLDIR)/libbfd.$(LB) $(LDIR)/libdwarf.$(LB) $(HOSTLIBS)
LIBLST  = $(LIBS)
#__dos__#LIBLST	= @liblst.rf

$(TARG): hc.pro liblst.rf $(OBJS) _version
	$(CC) $(OPT) $(OUT) $(TARG) $(LDFLAGS) $(OBJS) $(LIBLST)
#__dos__#	copy /b $(DOSXN)+$(TARG)$(EXP) $(TARG)$(EXE)
#__dos__#       $(CFIG) $(TARG) $(CFIGFLAGS)

hc.pro:
#__dos__#	$(CP) $(IDIR,/=\)\sys\hc.pro hc.pro
#__win95__#	@echo

liblst.rf:
#__dos__#	$(RM) liblst.rf
#__dos__#	!foreach i $(LIBS)
#__dos__#			echo -l$i >> liblst.rf
#__dos__#	!end 
#__win95__#	@echo

ghist960.$O: $(IDIR)/bfd.h $(BFDIDIR)/libbfd.h

#-----------------------------------------------------------------------------
#		'STANDARD' GNU/960 TARGETS BELOW THIS POINT
#-----------------------------------------------------------------------------

ver960.o: FORCE
	$(RM) ver960.c
	echo static char gnu960_ver[]=	 		 > ver960.c
	echo "	\"$(TARG) `cat _version`, `date`\";"	>> ver960.c
	echo \#include \"ver960.h\"			>> ver960.c
	$(CC) $(CFLAGS) -c ver960.c

# DOS version
ver960.obj: FORCE
	$(RM) ver960.c
	echo static char gnu960_ver[]=	 	 > ver960.c
	=$(LDIR)/verstr $(TARG)$(EXE) _version	>> ver960.c
	echo \#include "ver960.h"		>> ver960.c
	$(CC) $(CFLAGS) -c ver960.c

# Dummy target to force execution of dependent targets.
#
FORCE:


# 'G960BASE' will be defined at invocation
install:
	make $(TARG) LDIR="$(LDIR)" OPT="$(IOPT)" DOSXP=$(DOSXP) DOSXN=$(DOSXN)
	-$(STRIP) $(TARG)$(EXE)
	(cd $(DEST); $(RM) $(TARG)$(EXE))
	$(CP) $(TARG)$(EXE) $(DEST)
#__dos__#	(cd $(DEST); $(RM) $(TARG)$(EXP))
#__dos__#	$(CP) $(TARG)$(EXP) $(DEST)


# Separate lines required in order for DOS version to work
#
clean:
	$(RM) *.$O
	$(RM) $(TARG)$(EXE)
	$(RM) core
	$(RM) *.rex		# for DOS, doesn't hurt anybody else
	$(RM) *.exp		# for DOS, doesn't hurt anybody else
	$(RM) hc.pro   		# for DOS, doesn't hurt anybody else
	$(RM) liblst.rf		# for DOS, doesn't hurt anybody else

#-----------------------------------------------------------------------------
# Target to uncomment host-specific lines in this makefile, i.e. lines
# beginning in column 1 with the following string:  #__<hostname>__# .
# Original Makefile is backed up as 'Makefile.old'.
#
# Invoke with:  make make HOST=xxx
#-----------------------------------------------------------------------------
make:
	-@grep -s "^#The next line was generated by 'make make'" Makefile; \
	if test $$? = 0 ; then	\
		echo "Makefile has already been processed with 'make make'";\
		exit 1; \
	elif test $(HOST)x = x ; then \
		echo 'Specify "make make HOST=???"'; \
		exit 1; \
	else \
		mv -f Makefile Makefile.old; \
		echo "#The next line was generated by 'make make'"> Makefile;\
		echo "HOST=$(HOST)"				 >> Makefile; \
		echo						 >> Makefile; \
		sed "s/^#__$(HOST)__#//" < Makefile.old		 >> Makefile; \
		if test $(HOST) = dos; then mv Makefile makefile; fi \
	fi
