#The next line was generated by 'mkmake'
HOST=i386_nbsd1

#*****************************************************************************
# Makefile for libdwarf.a 
#
#*****************************************************************************

# Essential under System V, harmless elsewhere
SHELL = /bin/sh

TARG	= libdwarf.a
IDIR	= ../../include
CFLAGS	= $(OPT) -I$(IDIR) $(HOSTDEFS)

#-----------  DEFAULTS  ---------------------------
O	= o
RM	= rm -f
CP	= cp
OPT	= -g 
IOPT	= -O
NOLINK  = -c
HOSTNM	= \"$(HOST)\"
HOSTDEFS =
AR	= ar cr $(TARG) $(OBJLIST)
RANLIB	= echo > /dev/null
DEST	= $(G960BASE)/lib

#-----------------------------------------------------------------------------
# 		Uncomment for system V (i386v) release 4
#-----------------------------------------------------------------------------
# 		Uncomment for RS6000.
#__rs6000__#RANLIB	= ranlib
#-----------------------------------------------------------------------------
# 		Uncomment for HP9000-300
#-----------------------------------------------------------------------------
# 		Uncomment for HP9000-700
#-----------------------------------------------------------------------------
# 		Uncomment for Sun 4
#__sun4__#RANLIB	= ranlib
#-----------------------------------------------------------------------------
#		Uncomment for i386_nbsd1
RANLIB		= ranlib
#-----------------------------------------------------------------------------
#               Uncomment for Solaris on the sun4 (sol-sun4).
#-----------------------------------------------------------------------------
# 		Uncomment for DOS
#__dos__#TARG		= libdwarf.lib   
#__dos__#O		= obj
#__dos__#RM		= del
#__dos__#CP		= copy
#__dos__#HOSTNM		= "dos"
#				 Metaware can't handle -DHOST=\"xxx\"
#__dos__#HOSTDEFS	= -DDOS
#__dos__#OPT		= -g 
#__dos__#IOPT		= -O3
#__dos__#RANLIB		= @echo
#__dos__#AR		= 386lib -create -twocase $(TARG) $(OBJLIST)
#__dos__#DEST		=$(G960BASE,/=\)\lib
#__dos__#I_DIR          =$(IDIR,/=\)
#__dos__#CC             = HC386
#__dos__#CFLAGS		= -w1 -Hnocopyr -fsoft -Heol=10 $(OPT) -I$(I_DIR) $(HOSTDEFS)
#-----------------------------------------------------------------------------
# 		Uncomment for Windows 95
#__win95__#TARG		= libdwarf.lib   
#__win95__#O		= obj
#__win95__#HOSTDEFS	= -W2 -DWIN95 -DDOS
#__win95__#OPT		= -Zi
#__win95__#IOPT		= -O2
#__win95__#RANLIB		= @echo
#__win95__#AR		= lib /OUT:$(TARG) $(OBJLIST)
#__win95__#DEST		=$(G960BASE,/=\)\lib
#__win95__#I_DIR		=$(IDIR,/=\)
#__win95__#CC		= CL
#__win95__#CFLAGS	= $(OPT) -I$(I_DIR) $(HOSTDEFS)
#-----------------------------------------------------------------------------


OBJS	= aranges.$O arrayord.$O atname.$O attr.$O attrlist.$O bitoff.$O \
bitsize.$O \
bytesize.$O child.$O childcnt.$O common.$O cudieoff.$O cuoffdie.$O \
cupubdie.$O curange.$O dealloc.$O debug.$O dieline.$O diename.$O dieoff.$O \
encoding.$O error.$O errmsg.$O errnum.$O finish.$O formaddr.$O \
formblk.$O formref.$O formsdat.$O formstr.$O formudat.$O frame.$O \
hasattr.$O hasform.$O highpc.$O init.$O isbit.$O isbtype.$O \
isfirst.$O lines.$O lowpc.$O nextdie.$O nextline.$O offdie.$O parent.$O \
pcfile.$O \
pclines.$O pcsubr.$O prevline.$O pubdie.$O pubnames.$O seterra.$O \
seterrh.$O seterrm.$O seterrs.$O sibling.$O srclang.$O srclines.$O \
srcpubs.$O srcrange.$O tag.$O \
tree.$O typename.$O typeof.$O typesize.$O version.$O verlbdw.$O

OBJLIST = $(OBJS)
#__dos__#OBJLIST = @objs.rf
#__win95__#OBJLIST = @objs.rf

.c.o:
	$(CC) $(CFLAGS) $(NOLINK) $<

$(TARG): hc.pro objs.rf $(OBJS) 
	$(RM) $(TARG)
	$(AR)
	$(RANLIB) $(TARG)

objs.rf:
#__dos__#	!foreach i $(OBJS)
#__dos__#		echo -add $i >> objs.rf
#__dos__#	!end
#__win95__#	!foreach i $(OBJS)
#__win95__#		echo $i >> objs.rf
#__win95__#	!end

hc.pro:
#__dos__#       $(CP) $(I_DIR)\sys\hc.pro hc.pro
#__win95__#	@echo

$(OBJS):    internal.h $(IDIR)/libdwarf.h
pubnames.$O:	pubnames.h
cupubdie.$O:	pubnames.h
pubdie.$O:	pubnames.h
srcpubs.$O:	pubnames.h
aranges.$O:	aranges.h
curange.$O:	aranges.h
srcrange.$O:	aranges.h
lines.$O:	lines.h
srclines.$O:	lines.h
frame.$O:	frame.h

#-----------------------------------------------------------------------------
#		'STANDARD' GNU/960 TARGETS BELOW THIS POINT
#-----------------------------------------------------------------------------

FORCE:

# 'G960BASE' should be defined at invocation
# Avoid explicit use of "/" in pathnames, since DOS version needs "\"
install:
	make $(TARG) OPT="$(IOPT)"
	(cd $(DEST); $(RM) $(TARG))
	$(CP) $(TARG) $(DEST)

install_ctools: install

# Separate lines required in order for DOS version to work
#
clean:
	$(RM) $(TARG)
	$(RM) *.$O
	$(RM) core
	$(RM) objs.rf	# for DOS, doesn't hurt anybody else
	$(RM) hc.pro	# for DOS, doesn't hurt anybody else

#-----------------------------------------------------------------------------
# Target to uncomment host-specific lines in this makefile, i.e. lines
# beginning in column 1 with the following string:  #__<hostname>__# .
# Original Makefile is backed up as 'Makefile.old'.
#
# Invoke with:  make make HOST=xxx
#-----------------------------------------------------------------------------
make:
	-@grep -s "^#The next line was generated by 'make make'" Makefile; \
	if test $$? = 0 ; then	\
		echo "Makefile has already been processed with 'make make'";\
		exit 1; \
	elif test $(HOST)x = x ; then \
		echo 'Specify "make make HOST=???"'; \
		exit 1; \
	else \
		mv -f Makefile Makefile.old; \
		echo "#The next line was generated by 'make make'"> Makefile;\
		echo "HOST=$(HOST)"				 >> Makefile; \
		echo						 >> Makefile; \
		sed "s/^#__$(HOST)__#//" < Makefile.old		 >> Makefile; \
		if test $(HOST) = dos; then mv Makefile makefile; fi \
	fi
